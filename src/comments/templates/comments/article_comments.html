{% extends "base.html" %}

{% block content %}
<div class="container">
    <h1>Kommentare f√ºr "{{ article.title }}"</h1>
    <a href="{% url 'articles:detailed-article' article.slug %}">‚Üê Zur√ºck zum Artikel</a>

    <hr>

    <h3>Schreibe einen Kommentar:</h3>
    <form method="post">
        {% csrf_token %}
        {{ comment_form.as_p }}
        <button type="submit" name="submit_comment_form" class="btn btn-primary">Kommentieren</button>
    </form>

    <hr>

    <h3>Alle Kommentare:</h3>
    {% if comments.exists %}
        <ul class="comment-list">
            {% for comment in comments %}
                <li class="comment-item">
                    <div class="comment-header">
                        <strong>{{ comment.author.user.username }}</strong>
                        <small class="text-muted">am {{ comment.created|date:"d.m.Y H:i" }}</small>
                    </div>
                    <div class="comment-body">
                        {{ comment.content }}
                    </div>
                    <div class="comment-actions">
                        <!-- Like Button -->
                        <form method="post" action="{% url 'comments:like-comment-view' %}" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                            <button type="submit" class="btn btn-outline-success btn-sm">
                                üëç {{ comment.liked.count }}
                            </button>
                        </form>

                        <!-- Dislike Button -->
                        <form method="post" action="{% url 'comments:dislike-comment-view' %}" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                            <button type="submit" class="btn btn-outline-danger btn-sm">
                                üëé {{ comment.disliked.count }}
                            </button>
                        </form>

                        <!-- Antworten Button -->
                        <button class="btn btn-link btn-sm" onclick="toggleReplyForm('{{ comment.id }}')">
                            Antworten
                        </button>
                    </div>

                    <!-- Antwortformular -->
                    <div id="reply-form-{{ comment.id }}" class="reply-form" style="display: none;">
                        <form method="post" class="mt-2">
                            {% csrf_token %}
                            {{ secondary_comment_form.as_p }}
                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                            <button type="submit" name="submit_secondary_comment_form" class="btn btn-secondary btn-sm">
                                Antwort senden
                            </button>
                        </form>
                    </div>

                    <!-- Antworten anzeigen -->
                    {% if comment.replies.all %}
                        <ul class="reply-list">
                            {% for reply in comment.replies.all %}
                                <li class="reply-item">
                                    <div class="reply-header">
                                        <strong>{{ reply.author.user.username }}</strong>
                                        <small class="text-muted">am {{ reply.created|date:"d.m.Y H:i" }}</small>
                                    </div>
                                    <div class="reply-body">
                                        {{ reply.content }}
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Es gibt noch keine Kommentare f√ºr diesen Artikel.</p>
    {% endif %}
</div>

<script>
    function toggleReplyForm(commentId) {
        const form = document.getElementById(`reply-form-${commentId}`);
        if (form.style.display === "none") {
            form.style.display = "block";
        } else {
            form.style.display = "none";
        }
    }
</script>
{% endblock %}
