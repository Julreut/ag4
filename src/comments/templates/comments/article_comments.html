{% extends "base.html" %}

{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
{% endblock %}

{% block content %}
<div class="comment-system">
    <div class="container">
        <h2>Kommentare f√ºr "{{ article.title }}"</h2>
        <a href="{% url 'articles:detailed-article' news_paper_id=newspaper.id slug=article.slug %}" class="text-primary">‚Üê Zur√ºck zum Artikel</a>

        <hr>

        <div>
            <h4>Schreibe einen Kommentar:</h4>
            <form method="post">
                {% csrf_token %}
                <textarea name="content" rows="2" placeholder="Add a comment..."></textarea>
                <button type="submit" name="submit_comment_form">Senden</button>
            </form>
        </div>

        <hr>

        <div class="comment-section">
            <h4>Alle Kommentare:</h4>
            {% if comments.exists %}
                {% for comment in comments %}
                <div class="comment-item">
                    <div class="comment-header">
                        {{ comment.author.user.username }}
                        <small>{{ comment.created|date:"d.m.Y H:i" }}</small>
                    </div>
                    <div class="comment-body">
                        {{ comment.content }}
                    </div>
                    <div class="comment-actions">
                        <!-- Like -->
                        <form method="post" action="{% url 'comments:like-comment-view' %}">
                            {% csrf_token %}
                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                            <button type="submit">üëç {{ comment.liked.count }}</button>
                        </form>
                        <!-- Dislike -->
                        <form method="post" action="{% url 'comments:dislike-comment-view' %}">
                            {% csrf_token %}
                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                            <button type="submit">üëé {{ comment.disliked.count }}</button>
                        </form>
                        <!-- Reply -->
                        <button onclick="toggleReplyForm('{{ comment.id }}')" class="ui primary button" >Antworten</button>
                    </div>
                    <!-- Reply Form -->
                    <div id="reply-form-{{ comment.id }}" class="reply-form" style="display: none;">
                        <form method="post">
                            {% csrf_token %}
                            <textarea name="content" rows="1" placeholder="Write a reply..."></textarea>
                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                            <button type="submit" name="submit_secondary_comment_form">Senden</button>
                        </form>
                    </div>
                    <!-- loaded_replies -->
                    {% if comment.loaded_replies %}
                    <div class="reply-list">
                        {% for reply in comment.loaded_replies %}
                        <div class="reply-item">
                            <div class="comment-header">
                                {{ reply.author.user.username }}
                                <small>{{ reply.created|date:"d.m.Y H:i" }}</small>
                            </div>
                            <div class="comment-body">
                                {{ reply.content }}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p>Es gibt noch keine Kommentare f√ºr diesen Artikel.</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function toggleReplyForm(commentId) {
        const form = document.getElementById(`reply-form-${commentId}`);
        form.style.display = form.style.display === "none" ? "block" : "none";
    }
</script>
{% endblock %}
